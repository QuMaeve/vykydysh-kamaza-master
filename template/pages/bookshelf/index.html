{% extends 'layouts/main.html' %}

{% block title %}Моя полка{% endblock title %}

{% block content %} 
<section class="content">
    <div id="main">
        <h1>Моя полка</h1>
        <div class="container">
            <div class="row">
            {% for item in data %}
                {% with index=forloop.counter %}
                {% widthratio data.paginator.per_page 1 data.number|add:-1 as page_index %}
                <div class="card m-2 col-3">
                    <a href="{% url 'book-view' item.book.id %}">
                        <img src='{% firstof item.book.cover_path item.book.cover_url "/static/img/default-img.jpg" %}' style="height: 200px !important;" 
                        class="card-img-top" alt="...">
                    </a>    
                        <div class="card-body">
                            <h5 class="card-title">
                                <a href="{% url 'book-view' item.book.id %}">
                                    {{ item.book.name }}
                                </a>
                            </h5>
                            <h6 class="card-title">
                                {{ item.book.author.first_name | default:"" }}
                                {{ item.book.author.last_name | first | default:""}}.
                                {{ item.book.author.patronymic | first | default:"" }}.
                            </h6>
                            <p class="card-text">
                                {{ item.book.description|truncatechars:20| default:'<br>' }}
                            </p>
                            <p class="card-text">
                                <small class="text-muted">
                                    {{ item.book.genre| default:'<br>' }}
                                </small>
                            </p>
                            <a type="button" 
                            {% if item.book.doc_path != None %}
                            href='{{ item.book.doc_path }}' 
                            {% elif item.book.doc_url != None %}
                            href='{{ item.book.doc_url }}' 
                            {%else %} href='#'
                            {%endif%}
                            class="btn btn-outline-primary" >
                                Читать
                            </a>
                            {% for group in user.groups.all %}
                                {% if group.name == 'Администратор' or group.name == 'Библиотекарь' %}
                                    <a type="button" 
                                    href="{% url 'book-edit' item.book.id %}" 
                                    class="btn btn-outline-primary" >
                                        Редактировать
                                    </a>
                                {% endif %}
                            {% endfor %}
                            <p class="card-text">
                                <small class="text-muted">
                                    {{page_index|add:index}}
                                </small>
                            </p>
                        </div>
                    
                </div>
                {% endwith %}    
            {% endfor %}
            </div>
        </div>
        {% include 'components/pagination.html' %}
    </div>
</section>
{% endblock content %}